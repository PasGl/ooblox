<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>ooblox</title>
		<meta name="author" content="Pascal Gleske">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="icon" href="images/favicon.ico" type="image/vnd.microsoft.icon">
		<style>
			html, body
			{
				width: 100%;
				height: 100%;
			}
			body
			{
				background-color: #000000;
				margin: 0;
				overflow: hidden;
				font-family: arial;
			}
			.unselectable {
			    -webkit-touch-callout: none;
			    -webkit-user-select: none;
			    -khtml-user-select: none;
			    -moz-user-select: none;
			    -ms-user-select: none;
			    user-select: none;
			}

		</style>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/86/three.min.js"></script>
		<script src="js/loaders/ColladaLoader.js"></script>
		<script src="js/loaders/collada/Animation.js"></script>
		<script src="js/loaders/collada/AnimationHandler.js"></script>
		<script src="js/loaders/collada/KeyFrameAnimation.js"></script>

		<script src="js/renderers/CSS3DRenderer.js"></script>
		<script src="js/stats.min.js"></script>
		<script src="js/controls/OrbitControls.js"></script>

		<script src="js/vrgui/VREffect.js"></script>
		<script src="js/vrgui/webvr-polyfill.js"></script>
		<script src="js/vrgui/webvr-manager.js"></script>
		<script src="js/controls/VRControls.js"></script>
		<script src="js/Detector.js"></script>

		<script src="js/datguivr.min.js"></script>

		<script src="js/BBTubeGeometry.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js"></script>
		<script src="js/exporters/OBJExporter.js"></script>
		<script src="js/exporters/STLExporter.js"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

		<script>
			// list for contructors and vrObjectTypeIDs, to which each module contributes one of each
			var vrObjectConstructorList = [];
			var importTypesAvailable = [];

			// for modules, to get their parameters from the URL query string
			var getURLargs = function (uname){
				var allmodulArgs = window.location.href.substring(window.location.href.indexOf("?")+1, window.location.href.length);
				var allmodulArgsList = allmodulArgs.split("&");
				var indexInList = -1;
				for (var i=0;i<allmodulArgsList.length;i++)
				{
					if (uname === allmodulArgsList[i].substring(0, uname.length))
					{
						indexInList = i;
						break;
					}
				}
				var thisModuleArgString = allmodulArgsList[indexInList];

				return thisModuleArgString.split("+");
			}

			// for modules, to write changes made in their gui back into the URL query string
			var updateURLargs = function (argList) {
				var allmodulArgs = window.location.href.substring(window.location.href.indexOf("?")+1, window.location.href.length);
				var allmodulArgsList = allmodulArgs.split("&");
				var indexInList = -1;
				for (var i=0;i<allmodulArgsList.length;i++)
				{
					if (argList[0] === allmodulArgsList[i].substring(0, argList[0].length))
					{
						indexInList = i;
						break;
					}
				}
				var thisModuleArgs = argList;
				allmodulArgsList[indexInList] = thisModuleArgs[0] + "=" + thisModuleArgs.slice(1,thisModuleArgs.length).join("+");
				var newURLstring = "?"+allmodulArgsList.join("&");
				window.history.replaceState({}, '', newURLstring);
			}


		    	// loading all Modules in the folder /js/vrobjects ... needs webserver to autolist that folder (or 403 fail)
		    	// otherwise this section needs to be replaced by regular imports ala <script src="js/vrobjects/ooblox...
			$.get("./js/vrobjects", function(data) 
		        	{
					var modules = data.split("href=\"");
					modules.splice(0,1);
					for (var i=0;i<modules.length;i++)
					{
						var thisfilename= modules[i].substring(0,modules[i].indexOf("\""));
						if (thisfilename.substring(thisfilename.length-3,thisfilename.length+1)===".js")
						{													
							var newscript = document.createElement('script');
							newscript.type  = "text/javascript";
							newscript.src = 'js/vrobjects/'+thisfilename;
							$.getScript(newscript);
						}
					}
		        });
		</script>
	</head>
	<body onload="bootVR()">
		<div id="container" class="unselectable"></div>
		<script src="js/ooblox.js"></script>
	</body>
</html>
